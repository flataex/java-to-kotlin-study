# 자바에서 코틀린 컬렉션으로

## 자바 컬렉션
- 이전에는 객체를 변경가능한 값으로 보았었고 원소를 추가하는 컬렉션은 이러한 생각에 어울리는 객체입니다.
- 하지만 컬렉션과 같은 가변 객체의 상태가 변할 수 있다는 점은 예상한 상황과 다르게 동작할 수 있으므로 여러 문제를 야기시킬 수 있습니다.
- 가변 객체의 경우 에일리어싱 오류가 발생할 수 있기 때문에 불변 객체로 사용하는 것이 좋습니다.
- 사실 자바 컬렉션은 이론상 가변 컬렉션이지만, 실전에서 자바 컬렉션을 가변으로 사용하는 경우는 점점 줄어들고 있습니다.
- 자바 컬렉션을 이론상 가변 컬렉션이지만 실무에서는 자바 컬렉션을 가변으로 사용하는 경우는 줄어들고 있습니다.
    - Collections.unmodifiableList를 이용하면 컬렉션을 불변객체로 래핑해서 사용할 수 있습니다. (단 이방식도 원본 리스트를 변경하면 값이 변경되므로 완전한 불변성을 보장하지는 못합니다.)
    - List.copyOf(collection)을 이용하면 완전한 불변성을 보장할 수 있습니다.
- 서로 떨어진 두 코드 사이에 공유된 컬렉션이 있다면 변경의 위험을 막기 위해 이를 불변 컬렉션으로 취급하는 것이 좋습니다.
- 컬렉션은 생성만하고 값을 변경하지 않는 것이 좋습니다.
- 성능을 위해 가변 컬렉션을 사용해야 한다면 이름을 확실하게 표시하여 가변 컬렉션임을 표시하는 것이 좋습니다.

## 코틀린 컬렉션
- 코틀린은 상태변경을 좋아하지 않지만 자바와의 부드러운 상호 운용을 위해 상태를 바꾸는 메서드를 제거하여 불변성을 보장하지만 Mutable 컬렉션 객체를 통해 가변 컬렉션으로도 사용할 수 있습니다.
- 컴파일러를 통해 코틀린 List가 자바의 List로 인식되게 할 수 있고 자바의 List가 코틀린의 MutableList로 인식되게 할 수 있습니다.
- 코틀린의 List의 하위 타입이 MutableList이기 때문에 List가 가변성을 가지게 될수도 있기 때문에 주의해서 사용해야 합니다.
- 가변이 아닌 코틀린 컬렉션에 대한 공식 용어는 불변이 아니고 읽기 전용이며, 완전한 불변성을 보장해주지는 않습니다.
- 코틀린은 다른 함수형 언어(스칼라, 클로저)와 달리 불변 컬렉션과 가변 컬렉션의 하위호환성을 사용했습니다.
    - 파라미터로 받거나, 결과로 반환되거나, 다른 방식으로 사이에서 공유된 컬렉션을 항상 불변 컬렉션으로 취급해서 사용한다면 안전하게 사용할 수 있다. (단, 실수의 위험이 있습니다.)
    - 잠재적인 큰 위험을 받아들이는 대신 아주 단순하고 효율적인 자바 상호 운용성을 만들 수 있게 되었습니다.
- 타당한 범위 내에서 가능한 안전성을 택하지만 과도하게 안전을 추구하지 않는다는 실용주의는 전형적인 코틀린의 결입니다.

## 자바에서 코틀린 컬렉션으로 리팩터링 하기
- 어떤 자바 코드가 가변 컬렉션에 의존한다면 코틀린이 자바 코드에서 가정하는 불변 조건을 깨는일이 없는지 조심해야 합니다.
- 원본 리스트를 변경하지 말고 복사본을 만들어 사용하는 것이 안전합니다.
- 가변 상태를 가진 자바 컬렉션이 존재하는 상태로 코틀린 리팩터링시 MutableList로 변환될 위험이 있기 때문에 미리 자바 코드로 변환하는 것이 안전합니다.