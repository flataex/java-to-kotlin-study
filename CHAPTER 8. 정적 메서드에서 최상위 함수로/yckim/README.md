# 정적 메서드에서 최상위 함수로

## 자바의 정적 멤버
- 자바는 모든 값과 함수가 클래스에 속하며, 이런 값들을 멤버라고 부릅니다.
- 멤버의 값은 필드로, 함수는 메서드라고 부릅니다.
- 멤버의 값은 각 클래스 인스턴스마다 존재하며, 인스턴스가 다르면 값도 다릅니다.
- 멤버에 static 키워드를 붙이면 해당 멤버는 모든 인스턴스가 공유할 수 있는 멤버가 됩니다.
- 자바를 단순화 하기 위해 자바 언어 설계자는 모든 코드와 데이터를 클래스로 묶기로 했습니다.
- 클래스와 독립적으로 존재하는 데이터를 표현하기 위해 static 키워드를 사용합니다.
- 자바 설계자들은 JVM에서도 모든 코드와 데이터가 클래스에 속하도록 적용했고 이로인해 JVM에서도 최상위 코드나 데이터를 표현할 방법이 없습니다.
- 자바 초기에는 static을 많이 사용했지만 테스트 코드 작성이 유행하면서 static을 사용했을때 발생하는 높은 결합도가 문제 되어 사용이 줄어 들었습니다.
- 정적 함수는 그 함수가 작용할 대상 타입에 메서드를 추가하지 않고 기능을 추가하고 싶을 때 유용합니다.

## 코틀린 최상위 함수와 동반 객체
- 코틀린은 함수를 클래스 밖에 선언할 수 있으며, JVM에서는 이런 함수를 둘 곳이 없기 때문에 컴파일러가 최상위 선언을 넣기 위해 정적 멤버가 들어 있는 클래스를 생성해 줍니다.
- 코틀린에서는 클래스 안의 정적 멤버들을 표현할 때 object라는 키워드를 이용하여 싱글턴의 객체를 생성합니다.
- object로 선언한 멤버들은 @JvmStatic을 지정하지 않는 이상 실제로 정적 멤버로 컴파일 되지는 않습니다.
    - 코틀린은 싱글턴 객체가 다른 클래스로 확장하거나 인터페이스를 구현하도록 허용하는데, 정적 선언으로는 그런일을 할 수 없기 때문입니다.
- 정적 멤버와 비정적 멤버를 한 클래스 안에 모으는 경우 클래스 안에 정적인 부분을 companion object(동반 객체) 안에 위치시키면 됩니다.
    - 동반 객체도 다른 클래스를 확장하거나 인터페이스를 구현할 수 있는데, 자바의 정적 멤버에서는 이런 일이 불가능합니다.
- 정적 멤버를 선언할 때는 선언과 참조가 쉽고 코틀린 클라이언트 코드에 영향을 끼치지 않는 최상위 함수를 이용하여 작성하는 것이 좋습니다.
- 인터페이스를 구현하는 능력이 필요하거나 함수들을 더 밀접하게 묶고 싶은 경우에만 함수를 최상위 함수 대신 싱글턴 객체 안의 메서드로 정의하는 쪽을 택해야 합니다.
- 클래스안에 정적 행동 방식과 정적 행동 방식을 조합해야 하는 경우나 정적 팩토리 메서드 패턴을 작성해야 하는 경우에는 동반객체를 선택해야 합니다.
- 기본적으로는 가장 단순한 방법으로 문제를 해결하고 다른 방법이 가지는 이점이 클라이언트에 더 표현력이 좋은 API를 제공하거나 개발자에게 더 유지보수하기 쉽게 만들 경우 다른 방법으로 코드를 작성합니다.

## 정적 메서드를 최상위 함수로 리팩터링 하기
자바에서는 스트림의 기본연산을 구현하기 위해 직접 구현해야 하지만 코틀린은 이런 상황에서 편의 함수를 많이 제공하고 있습니다.

## 최상위로 옮기기
- @file:JvmName 어노테이션을 이용하여 최상위 함수로 함수의 이름을 지정할 수 있습니다.
    - 호출 형식 : @file:JvmName(”Shortlist”)
    - 해당 함수 사용 : Shortlist.byValue(…)
    - @file:JvmName으로 지정한 코드는 코틀린 상에서는 해당 이름을 인식할 수 없어 지정한 이름으로 import 경로를 설정하면 예외가 발생하게 됩니다.
- 인텔리제이의 Move to top level을 통해 IDE를 이용하여 최상위 수준으로 변경할 수 있습니다.

## 코틀린답게 다듬기
- 자바 스트림의 복잡한 구문을 코틀린의 다양한 표준 함수들을 통해 간결하게 작성할 수 있습니다.
- JVM은 코틀린 컴파일러가 생성한 메타데이터를 활용하지 않기 때문에 바이너리 의존성이 있는 최상위 함수가 라이브러리 버전이 바뀌면서 에러를 발생시킬 수 있습니다.
- @JvmName과 같은 메타데이터를 생성하는 어노테이션 같은 경우 코틀린 코드 상에서는 이를 감지할 수 없으므로 주의를 기울여야 합니다.