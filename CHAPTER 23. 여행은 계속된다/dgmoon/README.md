# ch.23 여행은 계속된다

그동안 배웠던 내용을 정리한다.

## 결

프로그래밍 언어마다 결이 있어서 프로그래밍 언어가 프로그램 설계에 영향을 끼친다는 비유.

코틀린의 결과 자바의 결은 다르다.

- 자바의 결
    - 가변 객체, 리플렉션 선호
    - 합성성, 타입안전성 낮음
- 코틀린의 결
    - 불변 값, 독립 함수 선호
    - 비침투적이며 도움이 많이 되는 타입 시스템 제공

자바와 코틀린은 한 코드 기반에 공존할 수 있으며, 상호운용성이 매우 높다. 그러나 코틀린의 엄격한 타입 때문에 느슨한 타입의 자바 코드와 상호작용 시 위험이 발생한다. 그러므로 리팩터링 도구를 사용하여 작고 안전하게 단계별로 코드를 변환하여야 한다.(직접 변환은 최후의 수단)

## 함수형 사고

소프트웨어에 대한 이해는 소프트웨어의 복잡도와 관련이 있으며, 복잡도는 언제 모든 일이 일어나느냐에 대한 혼동 때문에 발생한다. 함수형 프로그래밍에서는 어떤 일이 적게 발생하는 것이 가장 좋은 방법으로 여기며, 어떤 일이 발생하는 것을 ‘효과’(어떤 영역에서 관찰 수 있는 변화임)라고 한다.

함수 안에서 컬렉션이나 변수를 변경하는 일은 효과지만, 함수 밖으로 공유되지 못하거나 영향을 끼치지 못하면 효과가 아니다. 효과의 영역이 함수 내부로 한정되면, 시스템이 하는 일을 파악할 때 그 효과에 대해 생각할 필요가 없다. 반대로, 공유된 상태를 변경하면, 지역적인 효과가 공유된 상태의 모든 영역에 영향을 끼치고 복잡도가 늘어나 이해가 어려워진다.

따라서 함수형 프로그래밍에서는 변화를 줄여서 복잡도를 조절한다. 코틀린은 올바른 방향으로 이끌기 위한 관습을 내장하고 있다.(final 대신 불변 val 변수 선언,  컬렉션 읽기 전용 뷰, 데이터 클래스 등)

상태 변경이 없이 문제를 해결하는데 초점을 맞추면 시스템을 쉽게 이해하고 쉽게 변경할수 있게 만들 수 있다. “공유된 상태를 변경하지 말라”와 “딱 한 번만”(Once and only once) 원칙은 큰 효과를 얻을 수 있지만 부주의할 경우 복잡도를 오히려 증가시킬 수도 있다. 따라서 코드를 어렵게 만들지않으면서도 변이를 관리하는 기법과 그것을 알아볼 수 있는 안목을 길러야 한다.

함수형 기법은 객체 지향과 자주 배치된다. 하지만 그렇다고 해서 객체 지향의 이점까지 버려서는 안된다. 결론적으로, 객체와 클래스는 세계를 모델링하는 더 인간적인 방법이며 좋은 시작점이되는 경우가 있지만, 엄밀성이 필요하다면 함수형 프로그래밍이 좀 더 좋은 방법이 될 수 있다. 코틀린은 두 패러다임 간에 이동을 자유롭게 해주는 언어이다.

## 단순한 설계

단순한 설계를 정의하는 말 중 “의도를 드러냄”이 가장 해석의 여지가 많은 부분인데, 이때 의도는 변경과 동작을 함의하고 있다. 코드에서 동작과 계산을 구분하여, 어떤 것이 다른 것에 영향을 끼치는지 그렇지 않은지 알 수 있다. 코드 대부분이 계산이라면, 어떤 함수가 동작인지 명확히 표현할 경우 의도를 잘 드러낼 수 있다.

예를 들어, 20장 I/O 수행해서 동작을 분리하여 진입점에 최대한 가깝게 내보내는 것 등 → 설계가 단순해지고 코드의 복잡도가 낮아짐

## 함수형 프로그래밍과 텍스트를 통한 추론

함수형 프로그래밍에서는 UML과 같이 다이어그램이나 시각화에 초점을 맞추지 않는다. 함수형 프로그래밍의 목표는 ‘대수적 추론’이며, 이는 프로그램의 텍스트를 조작해 그것의 행동 방식을 추론하는 것을 말한다. '참조 투명성’과 ‘정적 타입’을 통해 프로그램에 대해 추론할 수 있으며 소스 코드의 실행 시점과 프로그램 상태 사이에 밀접한 연관이 생긴다. 함수적으로 코드를 작성할수록 코드의 시각화 없이도 시스템의 행동 방식을 알 수 있게 된다.

## 리팩터링

리팩터링은 개발자에게 매우 중요한 영역이다. 변경 영역이 작으면 직접 변경을 사용할 수 있지만, 영향을 받는 파일이 많아지면 지겨워지고 실수의 여지가 많아진다. 그러므로 리팩터링 시 작은 변경까지도 도구를 사용하는 연습을 해야 한다.

## 리팩터링과 함수형 사고

리팩터링과 함수형 사고 간에는 관계가 있다. 리팩터링은 코드를 재배열하는 것이고 재배열로 인해 동작의 실행과 소프트웨어의 기능이 달라질수 있다. 하지만 계산은 재배열을 해도 안전하므로, 함수형 사고에서는 동작을 구별하여 제어하도록 장려하며 더 안전하게 리팩터링을 할 수 있다. 코틀린은 함수형 프로그래밍과 객체지향을 함께 쓸 수 있게 해줄 뿐만 아니라 리팩터링을 지원하는 도구가 같이 제공된다. 지속적인 리팩터링을 통해 모든 변경을 쉬운 변경이 되도록 한다면 소프트웨어의 복잡성을 처리할 수 있을 것이다.
