# 동작에서 계산으로

## 함수
- 큰 프로그램 안에 속한 호출 가능한 하위 프로그램을 서브루틴, 함수, 프로시저, 메서드 등으로 다양하게 불립니다.
- 이 책을 기준으로는 애플리케이션에서 호출하는 프로그램들을 모두 함수라고 부르며, 함수가 특정 객체와 연관되어 있다는 점이 아주 중요한 경우에만 메서드로 부르겠습니다.
- 함수와 데이터의 차이점은 프로그램이 실행되면서 변화하는지에 대한 여부입니다. 함수는 일반적으로는 변하지 않으며, 데이터는 계속해서 변화합니다.
- 함수는 계산과 동작으로 나눌 수 있으며, 다음과 같이 구분합니다.
    - 동작은 얼마나 많이 호출되느냐에 따라 결과가 달라지는 함수입니다.
    - 계산은 호출된 시점과 상관 없이 항상 같은 결과를 반환하는 함수입니다.
- 우리가 작성하는 대부분의 함수는 동작입니다.

## 계산
- 계산은 같은 인자로 호출하게 되면 항상 같은 결과를 돌려주는 함수입니다.
- 값 타입 안에 정의된 계산된 프로퍼티는 항상 같은 값을 반환해야 합니다.
- 계산된 프로퍼티는 계산에 대해서만 사용해야 한다.
- 함수 실행중에 어떤 값이 변경된다면 함수 실행전과 실행 후의 결과가 다르므로 동작입니다.
## 동작
- 어떤 경우에서라도 외부에서 관찰가능한 부수 효과(side effect)가 있다면 동작 함수입니다.
    - println은 호출될 때마다 함수 외부에 영향을 주기 때문에 동작 함수입니다.
    - void나 Unit을 반환하는 함수는 동작일 가능성이 높다. (반환 값이 없으므로, 내부에서 어떤 외부의 상태를 변경할 확률이 높기 때문)
- 아무 파라미터도 없는 함수가 상수를 반환하는 경우에는 계산이지만, 변할 수 있는 외부로부터 데이터를 읽어서 결과를 돌려준다면 동작으로 분류할 수 있습니다.

## 왜 계산과 동작에 신경 쓰는가?
- 동작 함수는 각 동작이 호출되는 시점이나 호출 여부가 달라질 수 있기 때문에 리팩터링하기 어렵습니다.
- 계산 함수는 언제 호출되더라도 항상 같은 값을 반환하기 때문에 여러번 반복해 호출해도 영향이 발생하지 않아 안전합니다.
    - 비용이 많이 든다면 한번 계산 후 캐시하여 사용할 수 있고, 비용이 적다면 프로그램 단순화를 위해 매번 결과를 계산해도 안전합니다.
- 참조 투명한 함수란 프로그램에 어떤 함수가 있을 때 이 함수를 호출한 모든 부분에서 함수 호출을 그 함수 호출의 결과값(반환 값)으로 치환해도 프로그램이 똑같이 동작하는 것을 의미합니다.

## 왜 계산을 선호하는가?
- 동작 함수보다는 계산 함수가 훨씬 다루기 쉽습니다.
- 계산 함수는 항상 같은 결과를 기대할 수 있으므로 동작에 비해 순수한 코드입니다.
- 순수성이 높다면 동작이 예상하기 쉽기 때문에 리팩터링이 더 쉽게 진행할 수 있습니다.
- 리팩터링의 용이성으로 인해 순수한 코드들은 시스템 진입점에 가까운 위치로 가져오는 것이 좋습니다.
  - 개선에 성공한다면 코드 중 상당 부분이 계산 함수로 변경되기 때문에 더 쉽게 테스트하고, 성질을 추론하고, 리팩터링을 수행할 수 있습니다.

## 동작을 계산으로 리팩터링 하기
- 함수에 매개변수로 동작 함수의 결과를 전달할 경우 실행시마다 다른 값이 전달되면서 의도와 다른 동작을 할 수 있으므로 가능하면 분리해야 합니다.
- 동작 함수는 코드를 리팩터링하기 어렵게 할 뿐 아니라, 코드를 테스트하기도 어렵게 합니다.
- 테스트 실행시 계속해서 값이 변경되면 테스트 코드를 이해하기 어려워지며 구현에 따라 실행시점에 따라 테스트가 실패할 수 있는 상황이 발생할 수 있습니다.
- 내부의 동작 함수를 제거하고 외부로부터 인자로 받도록 변경하면 의존성을 줄일 수 있게 됩니다.
- 데이터베이스의 내장 함수를 사용하여 로직을 실행시킨다면 최대한 애플리케이션 상에서 처리할 수 있도록 변경해야 테스트하기 쉬워집니다.
- 아직은 코틀린이 자바보다 불변 데이터나 다른 함수형 구성 요소를 더 자연스럽게 지원하기 때문에 동작과 계산을 구분하는 비용을 더 낮춰주고 코드를 작성하는 가성비가 더 좋습니다.